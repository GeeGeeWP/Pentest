# Importing the correct modules
import os
import sys
from colorama import Fore, Back, Style

# Get Target Name and Target IP
ip = (sys.argv[1])
target = (sys.argv[2])

# Make the proper directories and files
os.system("mkdir ~/HTB/%s" % target)
os.system("mkdir ~/HTB/%s/nmap" % target)
print(Fore.RED + '*' * 50)
print(Style.RESET_ALL) 

# Start nmap scan
# Come bak to this and optimize!
os.system("nmap %s -p- -oN output" % ip)
os.system("cat output | grep open > deleteme")
os.system("sed -i 's/open//g' deleteme")
os.system("sed -i 's/tcp//g' deleteme")
os.system("cat deleteme | tr -d '/' | tr -s ' ' > deleteme2")
os.system("rm deleteme")
os.system("nmap %s -p- -sC -sV -oG %s" % (ip, target))
print(Fore.RED + '*' * 50)
print(Style.RESET_ALL)
os.system("cat %s | grep Ports | cut -d ':' -f3 | sed s/,/\\n/g > output" % target)
os.system("mv %s ~/HTB/%s/nmap/" % (target, target))

# Testing what ports are open
with open('output') as http:
    if 'http' in http.read():
	os.system("python http.py %s %s" % (ip, target))

with open('output') as ftp:
    if 'http' in ftp.read():
        os.system("python ftp.py %s %s" % (ip, target))

with open('output') as smbd:
    if 'smbd' in smbd.read():
        os.system("python smbd.py %s %s" % (ip, target))

print '*' * 50
print 'Scan Done'
